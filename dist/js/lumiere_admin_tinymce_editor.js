!function(n){tinymce.create("tinymce.plugins.lumiere_link_maker",{init:function(i,e){var a='<img src="'+lumiere_admin_vars.imdb_path+'pics/lumiere-ico-noir13x13.png" class="lumiere_admin_tiny_img" width="13" />';i.addButton("lumiere_tiny",{title:"Lumière! add info",image:lumiere_admin_vars.imdb_path+"pics/lumiere-ico-noir13x13.png",type:"menubutton",menu:[{text:"Add a popup",onclick:function(){var e=i.selection.getContent();i.windowManager.open({width:300,height:150,title:"Lumière! Add a link to a popup",body:[{type:"textbox",name:"textboxName",label:"Movie title",value:e}],onsubmit:function(e){!(target="")===e.data.blank&&(target+='newtab="on"'),i.insertContent(' <span data-lum_link_maker="popup">'+e.data.textboxName+"</span> ")}})},onPostRender:function(){var n=this;i.on("NodeChange",function(e){var t=jQuery(i.selection).attr("data-lum_link_maker");n.active(t)})}},{text:"Add a movie section",onclick:function(){var e=i.selection.getContent(),t=e||"";i.windowManager.open({width:450,height:200,title:"Lumière! Add a movie section inside the post",body:[{type:"textbox",name:"movieReference",label:"Movie title/IMDb ID",value:e},{type:"listbox",name:"movieFormat",label:"My movie is inserted by:",values:[{text:"By title",value:"movie_title"},{text:"By id",value:"movie_id"}]},{type:"button",name:"IMDbID",label:"Find IMDb ID",text:"Open Search Window",onclick:function(){i.windowManager.open({title:"Internal Query to find IMDb ID",file:lumiere_admin_vars.wordpress_path+lumiere_admin_vars.gutenberg_search_url+"?moviesearched="+t,width:500,height:400,inline:1},{editor:i,jquery:n,valid_value:"value"})}}],onsubmit:function(e){!(target="")===e.data.blank&&(target+='newtab="on"'),i.insertContent(' <span data-lum_movie_maker="'+e.data.movieFormat+'">'+e.data.movieReference+"</span> ")}})},onPostRender:function(){var n=this;i.on("NodeChange",function(e){var t=jQuery(i.selection).attr("data-lum_movie_maker");n.active(t)})}},{text:"Find IMDb ID",onclick:function(){var e=i.selection.getContent();i.windowManager.open({title:"Internal Query to find IMDb ID",file:lumiere_admin_vars.wordpress_path+lumiere_admin_vars.gutenberg_search_url+"?moviesearched="+(e||""),width:500,height:400,inline:1},{editor:i,jquery:n,valid_value:"value"})}}]}),i.on("PostProcess",function(e){e.get&&(e.content=e.content.replace(/<img class="lumiere_admin_tiny_img"[^>]+>/g,""))}),i.on("BeforeSetContent",function(e){var t=a+' <span data-lum_movie_maker="movie_title">',n=a+' <span data-lum_movie_maker="movie_id">';e.content=e.content.replace(/<span data-lum_link_maker=[^>]+>/g,a+' <span data-lum_link_maker="popup">'),e.content=e.content.replace(/<span data-lum_movie_maker="movie_title">/g,t),e.content=e.content.replace(/<span data-lum_movie_maker="movie_id">/g,n)}),i.on("NodeChange",function(e,t){e.setActive("lumiere_tiny","SPAN"===t.nodeName&&jQuery(i.selection).attr("data-lum_link_maker"))})},createControl:function(e,t){return null},getInfo:function(){return{longname:"Lumière TinyMCE editor",author:"JCV",authorurl:"https://www.jcvignoli.com/blog",infourl:"https://www.jcvignoli.com/en/lumiere-movies-wordpress-plugin/",version:"4.0"}}}),tinymce.PluginManager.add("lumiere_tiny",tinymce.plugins.lumiere_link_maker)}(jQuery);